<!DOCTYPE html>
<html>
  <head>
    <!-- stylesheet -->
    <link href="css/literallycanvas.css" rel="stylesheet">

    <!-- dependency: React.js -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js"></script>

    <!-- Literally Canvas -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/literallycanvas.js"></script>

  </head>
  <body>
    <!-- where the widget goes. you can do CSS to it. -->
    <div class="literally"></div>
    <form class="imgur-submit">
        <input type="text" name = "cardName" placeholder = "Enter card name here"/>
        <input type="submit" data-action="upload-to-imgur" value="Upload to Imgur">
        <p class="message"></p>
    </form>

    <!-- kick it off -->
    <script>
      $(document).ready(function(){
        // Look ma, no jQuery!
        var TTS_Test;
        var TTS_SaveFile;
        var url;
        var uploaded = false;
        var cardName;

        var lc = LC.init(
            document.getElementsByClassName('literally')[0],
            {imageURLPrefix: 'img'}
        );

        /* or if you just love jQuery,
            $('.literally').literallycanvas({imageURLPrefix: 'img'})
        */

        $('[data-action=upload-to-imgur]').click(function(e) {
            e.preventDefault();

            $('.message').html('Uploading...');
            
            cardName = $('input[name="cardName"]').val();

            // this is all standard Imgur API; only LC-specific thing is the image
            // data argument;
            
            $.ajax({
              url: 'https://api.imgur.com/3/image',
              type: 'POST',
              headers: {
                // Your application gets an imgurClientId from Imgur
                Authorization: 'Client-ID ' + 'a804111608f1744',
                Accept: 'application/json'
              },
              data: {
                // convert the image data to base64
                image:  lc.canvasForExport().toDataURL().split(',')[1],
                type: 'base64'
              },
              success: function(result) {
                url = 'https://i.imgur.com/' + result.data.id +'.png';
                $('.message').html("<a href='" + url + "'>" + url + "</a>");
                createdJSON('https://i.imgur.com/' + result.data.id +'.png');
              },
            });
          });
        });
    </script>

  </body>
</html>
